$().ready(function(){iDataTable_table.init();select_row.init();delete_rows.init();clear_rows.init()});iDataTable={iCheck_setting:{checkboxClass:"icheckbox_minimal-grey"},dataTable:null,oTable:null,deleteRow:null,deleteRow_click:function(e){e.preventDefault();iDataTable.deleteRow_selected=$(this);$.colorbox({initialHeight:"0",initialWidth:"0",opacity:"0.3",href:".deleteConfirmDialog",inline:true,closeButton:false})},deleteRow_selected:null,deleteRowsButton:null,operateRowsButton:null,operateRowsButton_enabled:false,selectRows:null,selectRows_ifToggled:function(){iDataTable.selectRow_enabled.iCheck(this.checked?"check":"uncheck")},selectRow:null,selectRow_enabled:null,selectRow_enabled_ifToggled:function(){iDataTable.selectRow_selected_size+=this.checked?1:-1;$(this).closest("tr").toggleClass("selected");if(iDataTable.selectRow_selected_size){if(!iDataTable.operateRowsButton_enabled){if(iDataTable.operateRowsButton.length){iDataTable.operateRowsButton.toggleClass("disabled")}iDataTable.operateRowsButton_enabled=true}}else{if(iDataTable.operateRowsButton_enabled){if(iDataTable.operateRowsButton.length){iDataTable.operateRowsButton.toggleClass("disabled")}iDataTable.operateRowsButton_enabled=false}}},selectRow_selected_size:0,selectRow_disabled:null,selectRow_disabled_each:function(index,input){var $input=$(input);$input.parent().attr("data-hint",$input.prop("title")).addClass("hint--top hint--error");$input.removeAttr("title")}};iDataTable_table={init:function(){$.extend(true,$.fn.dataTable.defaults,{"fnDrawCallback":function(oSettings){iDataTable.selectRow=$("table.dataTable td.tableCheckbox input.selectRow");if(iDataTable.selectRow.length){iDataTable.selectRow.iCheck(iDataTable.iCheck_setting);iDataTable.selectRow_enabled=iDataTable.selectRow.filter(":enabled");if(iDataTable.selectRow_enabled.length){iDataTable.selectRow_enabled.unbind("ifToggled");iDataTable.selectRow_enabled.on("ifToggled",iDataTable.selectRow_enabled_ifToggled)}iDataTable.selectRow_disabled=iDataTable.selectRow.filter(":disabled");if(iDataTable.selectRow_disabled.length){iDataTable.selectRow_disabled.each(iDataTable.selectRow_disabled_each)}}iDataTable.deleteRow=$("table.dataTable td a.deleteRow");if(iDataTable.deleteRow.length){iDataTable.deleteRow.unbind("click");iDataTable.deleteRow.click(iDataTable.deleteRow_click)}}});iDataTable.dataTable=$("table.dataTable");if(iDataTable.dataTable.length){iDataTable.dataTable.dataTable(dataTableSettings);iDataTable.oTable=iDataTable.dataTable.dataTable()}var $dataTableActions=$("div.dataTableActions");if($dataTableActions.length){$("div.dataTables_wrapper .actions").append($("div.dataTableActions"))}iDataTable.deleteRowsButton=$("div.dataTables_wrapper a.deleteRows");iDataTable.operateRowsButton=$("div.dataTables_wrapper a.operateRows");if(iDataTable.operateRowsButton){iDataTable.operateRowsButton.addClass("disabled")}}};select_row={init:function(){iDataTable.selectRows=$("table.dataTable th.tableCheckbox input.selectRows");if(iDataTable.selectRows.length){iDataTable.selectRows.iCheck(iDataTable.iCheck_setting);iDataTable.selectRows.on("ifToggled",iDataTable.selectRows_ifToggled)}}};delete_rows={init:function(){var $selectedRows=null;if(iDataTable.deleteRowsButton.length){iDataTable.deleteRowsButton.click(function(e){e.preventDefault();$selectedRows=$("table.dataTable td.tableCheckbox input.selectRow:checked");if($selectedRows.length){$.colorbox({initialHeight:"0",initialWidth:"0",opacity:"0.3",href:".deleteConfirmDialog",inline:true,closeButton:false})}else{$.globalMessenger().post({id:"needSelectRows",type:"error",message:"请选择需要删除的记录",showCloseButton:true})}})}var $confirmYes=$("div.deleteConfirmDialog a.confirmYes");if($confirmYes.length){$confirmYes.click(function(e){e.preventDefault();var $this=$(this);$this.attr("disabled",true);if(iDataTable.deleteRowsButton.length&&$selectedRows.length){$.ajax({url:iDataTable.deleteRowsButton.prop("href"),type:"post",data:$selectedRows.serialize(),dataType:"json",cache:false,success:function(message){$.globalMessenger().post({type:message.type,message:message.cont,showCloseButton:true});if(message.type=="success"){$selectedRows.closest("tr").fadeTo(300,0,function(){$(this).remove();iDataTable.oTable.fnDeleteRow(this)});iDataTable.selectRows.iCheck("uncheck")}$this.attr("disabled",false);$(".deleteConfirmDialog").colorbox.close()}})}else{if(iDataTable.deleteRow_selected.length){$.ajax({url:iDataTable.deleteRow_selected.prop("href"),type:"post",data:"id="+iDataTable.deleteRow_selected.attr("deleteId"),dataType:"json",cache:false,success:function(message){$.globalMessenger().post({type:message.type,message:message.cont,showCloseButton:true});if(message.type=="success"){iDataTable.deleteRow_selected.closest("tr").fadeTo(300,0,function(){$(this).remove();iDataTable.oTable.fnDeleteRow(this)});iDataTable.deleteRow_selected=null}$this.attr("disabled",false);$(".deleteConfirmDialog").colorbox.close()}})}}})}var $confirmNo=$("div.deleteConfirmDialog a.confirmNo");if($confirmNo.length){$confirmNo.click(function(e){e.preventDefault();$(".deleteConfirmDialog").colorbox.close()})}}};clear_rows={init:function(){var $clearRows=$("div.dataTables_wrapper a.clearRows");if($clearRows.length){$clearRows.click(function(e){e.preventDefault();if(iDataTable.oTable.fnGetNodes().length){$.colorbox({initialHeight:"0",initialWidth:"0",opacity:"0.3",href:".clearConfirmDialog",inline:true,closeButton:false})}else{$.globalMessenger().post({id:"needHasRows",type:"error",message:"记录已清空或没有任何记录",showCloseButton:true})}})}var $confirmYes=$("div.clearConfirmDialog a.confirmYes");if($confirmYes.length){$confirmYes.click(function(e){e.preventDefault();var $this=$(this);$this.attr("disabled",true);$.ajax({url:$clearRows.prop("href"),type:"post",dataType:"json",cache:false,success:function(message){$.globalMessenger().post({type:message.type,message:message.cont,showCloseButton:true});if(message.type=="success"){iDataTable.oTable.fnClearTable()}$this.attr("disabled",false);$(".clearConfirmDialog").colorbox.close()}})})}var $confirmNo=$("div.clearConfirmDialog a.confirmNo");if($confirmNo.length){$confirmNo.click(function(e){e.preventDefault();$(".clearConfirmDialog").colorbox.close()})}}};