/*
 * Copyright 2010-2013 icl-network.com. All rights reserved.
 * Support: http://www.icl-network.com
 *
 * JavaScript - Investment
 * Version: 3.0
 */
$().ready(function() {

		var $investmentFrom = $("#investmentFrom"), $investmentFromSubmit = $investmentFrom.find(":submit"), rsaKey = new RSAKey();
	var $password = $("#password");
	$investmentFromSubmit.prop("disabled", false);
	rsaKey.setPublic(b64tohex(modulus), b64tohex(exponent));
	$investmentFrom.validate({
		rules: {
			amount: {
				required: true,
				digits: true,
				min: multiples,
				max: available,
				multiples: multiples,
				maxlength: 8
			}
		},
		messages: {
			amount: {
				required: "请输入投资金额",
				digits: "请输入正确的投资金额",
				min: "投资金额最小为" + multiples + "元",
				max: "可用余额不足",
				multiples: "投资金额须为" + multiples + "元的整数倍",
				maxlength: "投资金额超出限制"
			}
		},
		errorPlacement: function(error, element) {
			element.next().text(error.text());
		},
		unhighlight: function(element) {
			$(element).next().text("");
		},
		submitHandler: function(form) {
			$.layer({
			    title: ['请输入支付密码', true],
				shade: [0.5, '#000', true],
			    dialog: {
					type: -1,
					btns: 2,
					btn: ['确定', '取消'],
					msg: '<div style="height: 30px; margin: 20px;">支付密码：<input id="paymentPassword" type="password" /><p class="annotate" style="color: red; line-height: 14px; height: 14px; margin: 5px 0;"></p></div>',
					yes: function(index) {
						var $paymentPassword = $("#paymentPassword");
						if($paymentPassword.val() != "" && $paymentPassword.val() != null) {
							$password.val(hex2b64(rsaKey.encrypt($paymentPassword.val())));
							form.submit();
						} else {
							$paymentPassword.next().text("请输入支付密码");
						}
					}				}
			});
		}
	});

	var $commentForm = $("#commentForm"), $commentFormSubmit = $commentForm.find(":submit");
	$commentFormSubmit.prop("disabled", false);
	$commentForm.validate({
		rules: {
			cont: {
				required: true,
				rangelength: [2,500] 
			}
		},
		messages: {
			cont: {
				required: "请输入评论内容",
				rangelength: "请输入2-500字的评论内容" 
			}
		},
		errorPlacement: function(error, element) {
			element.next().text(error.text());
		},
		unhighlight: function(element) {
			$(element).next().text("");
		},
		submitHandler: function(form) {
			$commentFormSubmit.prop("disabled", true);
			form.submit();
		}
	});
	
	var $commentReplyForm = $("#commentReplyForm"), $commentReplyFormSubmit = $commentReplyForm.find(":submit");
	$commentReplyFormSubmit.prop("disabled", false);
	$commentReplyForm.validate({
		rules: {
			cont: {
				required: true,
				rangelength: [2,500] 
			}
		},
		messages: {
			cont: {
				required: "请输入评论内容",
				rangelength: "请输入2-500字的评论内容" 
			}
		},
		errorPlacement: function(error, element) {
			element.next().text(error.text());
		},
		unhighlight: function(element) {
			$(element).next().text("");
		},
		submitHandler: function(form) {
			$commentReplyFormSubmit.prop("disabled", true);
			form.submit();
		}
	});
	
	$('#products').slides({
		preload: true,
		preloadImage: '/P2P-2.0-YuXinChuangTou/resources/images/loading.gif?version=20140416',
		effect: 'slide, fade',
		crossfade: true,
		slideSpeed: 200,
		fadeSpeed: 500,
		generateNextPrev: true,
		generatePagination: false
	});

});