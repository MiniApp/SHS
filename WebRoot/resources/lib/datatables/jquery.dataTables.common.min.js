$().ready(function(){galery_table.init();select_row.init();delete_rows.init();clear_rows.init()});galery={iCheck_setting:{checkboxClass:"icheckbox_minimal-grey"},dataTable:null,oTable:null,deleteRow:null,deleteRow_click:function(e){e.preventDefault();galery.deleteRow_selected=$(this);$.colorbox({initialHeight:"0",initialWidth:"0",opacity:"0.3",href:".deleteConfirmDialog",inline:true,closeButton:false})},deleteRow_selected:null,deleteRowsButton:null,operateRowsButton:null,operateRowsButton_enabled:false,selectRows:null,selectRows_ifToggled:function(){galery.selectRow_enabled.iCheck(this.checked?"check":"uncheck")},selectRow:null,selectRow_enabled:null,selectRow_enabled_ifToggled:function(){galery.selectRow_selected_size+=this.checked?1:-1;$(this).closest("tr").toggleClass("selected");if(galery.selectRow_selected_size){if(!galery.operateRowsButton_enabled){if(galery.operateRowsButton.length){galery.operateRowsButton.toggleClass("disabled")}galery.operateRowsButton_enabled=true}}else{if(galery.operateRowsButton_enabled){if(galery.operateRowsButton.length){galery.operateRowsButton.toggleClass("disabled")}galery.operateRowsButton_enabled=false}}},selectRow_selected_size:0,selectRow_disabled:null,selectRow_disabled_each:function(index,input){var $input=$(input);$input.parent().attr("data-hint",$input.prop("title")).addClass("hint--top hint--error");$input.removeAttr("title")}};galery_table={init:function(){$.extend(true,$.fn.dataTable.defaults,{"fnDrawCallback":function(oSettings){galery.selectRow=$("table.dataTable td.tableCheckbox input.selectRow");if(galery.selectRow.length){galery.selectRow.iCheck(galery.iCheck_setting);galery.selectRow_enabled=galery.selectRow.filter(":enabled");if(galery.selectRow_enabled.length){galery.selectRow_enabled.unbind("ifToggled");galery.selectRow_enabled.on("ifToggled",galery.selectRow_enabled_ifToggled)}galery.selectRow_disabled=galery.selectRow.filter(":disabled");if(galery.selectRow_disabled.length){galery.selectRow_disabled.each(galery.selectRow_disabled_each)}}galery.deleteRow=$("table.dataTable td a.deleteRow");if(galery.deleteRow.length){galery.deleteRow.unbind("click");galery.deleteRow.click(galery.deleteRow_click)}}});galery.dataTable=$("table.dataTable");if(galery.dataTable.length){galery.dataTable.dataTable(dataTableSettings);galery.oTable=galery.dataTable.dataTable()}var $dataTableActions=$("div.dataTableActions");if($dataTableActions.length){$("div.dataTables_wrapper .actions").append($("div.dataTableActions"))}galery.deleteRowsButton=$("div.dataTables_wrapper a.deleteRows");galery.operateRowsButton=$("div.dataTables_wrapper a.operateRows");if(galery.operateRowsButton){galery.operateRowsButton.addClass("disabled")}}};select_row={init:function(){galery.selectRows=$("table.dataTable th.tableCheckbox input.selectRows");if(galery.selectRows.length){galery.selectRows.iCheck(galery.iCheck_setting);galery.selectRows.on("ifToggled",galery.selectRows_ifToggled)}}};delete_rows={init:function(){var $selectedRows=null;if(galery.deleteRowsButton.length){galery.deleteRowsButton.click(function(e){e.preventDefault();$selectedRows=$("table.dataTable td.tableCheckbox input.selectRow:checked");if($selectedRows.length){$.colorbox({initialHeight:"0",initialWidth:"0",opacity:"0.3",href:".deleteConfirmDialog",inline:true,closeButton:false})}else{$.globalMessenger().post({id:"needSelectRows",type:"error",message:"请选择需要删除的记录",showCloseButton:true})}})}var $confirmYes=$("div.deleteConfirmDialog a.confirmYes");if($confirmYes.length){$confirmYes.click(function(e){e.preventDefault();var $this=$(this);$this.attr("disabled",true);if(galery.deleteRowsButton.length&&$selectedRows.length){$.ajax({url:galery.deleteRowsButton.prop("href"),type:"post",data:"_method=delete&"+$selectedRows.serialize(),dataType:"json",cache:false,success:function(message){$.globalMessenger().post({type:message.type,message:message.cont,showCloseButton:true});if(message.type=="success"){$selectedRows.closest("tr").fadeTo(300,0,function(){$(this).remove();galery.oTable.fnDeleteRow(this)});galery.selectRows.iCheck("uncheck")}$this.attr("disabled",false);$(".deleteConfirmDialog").colorbox.close()}})}else{if(galery.deleteRow_selected.length){$.ajax({url:galery.deleteRow_selected.prop("href"),type:"post",data:"_method=delete&id="+galery.deleteRow_selected.attr("deleteId"),dataType:"json",cache:false,success:function(message){$.globalMessenger().post({type:message.type,message:message.cont,showCloseButton:true});if(message.type=="success"){galery.deleteRow_selected.closest("tr").fadeTo(300,0,function(){$(this).remove();galery.oTable.fnDeleteRow(this)});galery.deleteRow_selected=null}$this.attr("disabled",false);$(".deleteConfirmDialog").colorbox.close()}})}}})}var $confirmNo=$("div.deleteConfirmDialog a.confirmNo");if($confirmNo.length){$confirmNo.click(function(e){e.preventDefault();$(".deleteConfirmDialog").colorbox.close()})}}};clear_rows={init:function(){var $clearRows=$("div.dataTables_wrapper a.clearRows");if($clearRows.length){$clearRows.click(function(e){e.preventDefault();if(galery.oTable.fnGetNodes().length){$.colorbox({initialHeight:"0",initialWidth:"0",opacity:"0.3",href:".clearConfirmDialog",inline:true,closeButton:false})}else{$.globalMessenger().post({id:"needHasRows",type:"error",message:"记录已清空或没有任何记录",showCloseButton:true})}})}var $confirmYes=$("div.clearConfirmDialog a.confirmYes");if($confirmYes.length){$confirmYes.click(function(e){e.preventDefault();var $this=$(this);$this.attr("disabled",true);$.ajax({url:$clearRows.prop("href"),type:"post",data:"_method=delete",dataType:"json",cache:false,success:function(message){$.globalMessenger().post({type:message.type,message:message.cont,showCloseButton:true});if(message.type=="success"){galery.oTable.fnClearTable()}$this.attr("disabled",false);$(".clearConfirmDialog").colorbox.close()}})})}var $confirmNo=$("div.clearConfirmDialog a.confirmNo");if($confirmNo.length){$confirmNo.click(function(e){e.preventDefault();$(".clearConfirmDialog").colorbox.close()})}}};